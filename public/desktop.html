<!DOCTYPE html>
<html>
    <head>
            <title>A3</title>

            <script src="js/aframe-v0.8.2.min.js"></script>
            <script src="js/socket.io.min.js"></script>
            <script src="//cdn.rawgit.com/donmccurdy/aframe-physics-system/v3.3.0/dist/aframe-physics-system.min.js"></script>
    </head>
    <body>
        
        <script>
            function onSceneLoad(){
                let cursor = document.querySelector('#cursor');
                let wrapper = document.querySelector('#drawing');


                document.querySelector('#small_button').addEventListener('click', function(e) {
                    console.log(e);
                    socket.emit('needSmallShape');
                });
                document.querySelector('#med_button').addEventListener('click', function(e) {
                    console.log(e);
                    socket.emit('needMedShape');
                });
                document.querySelector('#big_button').addEventListener('click', function(e) {
                    console.log(e);
                    socket.emit('needBigShape');
                });
            
            let socket = io();

            //default connect event
            socket.on('connect', function() {
                console.log("connected!");
            });

            socket.on('appendShape', function(data) {
                console.log('New Shape Received');
                console.log(data);
                let newEl = document.createElement('a-entity');
                newEl.setAttribute('geometry', {primitive: data.description.id});
                newEl.attributes.geometry.value="primitive:" + data.description.id;
                newEl.object3D.position.set(0, -1, -2);

                newEl.addEventListener('click', function(e){
                    placeObj(e);
                });
    
                cursor.appendChild(newEl);
            });
            
            function placeObj(e){
                let pos = e.target.object3D.localToWorld(e.target.object3D.position);
                console.log(pos);
                wrapper.appendChild(e.target);
                //newEl.setAttribute('position', pos);
                console.log(e.target);
            };
        };
        </script>

        <a-scene physics="debug: true; restitution: 0.3">
            <!---------------- CAMERA ---------------->
            <a-entity id="cameraRig" position="0 2 0" rotation="0 0 0">
                <a-camera id="sceneCamera">
                    <a-entity id="cursor" cursor="rayOrigin: mouse" position="0 0 -1"></a-entity>
                </a-camera>
            </a-entity>


            <!---------------- LIGHTING ---------------->
            <a-light type="ambient" color="white" position="35 5 0" intensity="0.6"></a-light>
            <a-light type="ambient" color="white" position="-0.15682 5.09305 0" intensity="0.4" light="type:point;color:#f7a83e"></a-light>



            <!---------------- A-FRAME ENTITIES ---------------->
        
            <!-- SOUNDS ENTITIES & TEXTURES-->
            <img id="small_tex" src="assets/small_button_tex.jpg"></img>
            <img id="med_tex" src="assets/med_button_tex.jpg"></img>
            <img id="big_tex" src="assets/big_button_tex.jpg"></img>

            <!-- <a-entity id="music" sound="src:#musicSrc; volume: 1; loop: true; positional:false" ></a-entity>
            <a-entity id="ambiance" sound="src:#ambianceSrc; volume: .4; loop: true; positional:false"></a-entity> -->

    
            <a-plane id="small_button" position="7 7 -6" width="5" height="2" rotation="0 -15 0" material="src:#small_tex;" shadow></a-plane> 
            <a-plane id="med_button" position="7 4.5 -6" width="5" height="2" rotation="0 -15 0" material="src:#med_tex;" shadow></a-plane> 
            <a-plane id="big_button" position="7 2 -6" width="5" height="2" rotation="0 -15 0" material="src:#big_tex;" shadow></a-plane> 


            <a-entity id="drawing" position="0 0 0"></a-entity>

            <!-- GROUND & SKY -->
            <a-plane static-body id="ground" position="0 0 5" width="30" height="30" rotation="-90 0 0" color="#a5a5a5" shadow></a-plane> 
                    
            <a-sky color="#ECECEC" ></a-sky>
        </a-scene>
        <script>
            document.querySelector('a-scene').addEventListener('loaded', onSceneLoad);
        </script>
    </body>
</html>